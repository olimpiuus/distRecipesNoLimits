import{r as s,j as o,i as R,o as U,L as C,a as z,b as D}from"../chunks/chunk-BuLkwGUr.js";import{R as N}from"../chunks/chunk-Cvvvrain.js";/* empty css                      */import"../chunks/chunk-CXsRlRas.js";/* empty css                      *//* empty css                      *//* empty css                      */function A(){const[i,P]=s.useState(""),[h,y]=s.useState(!1),[S,j]=s.useState(null),[d,p]=s.useState([]);s.useRef("");const m=s.useRef(null);s.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("q")||"";P(l)},[]),s.useEffect(()=>{if(!i){p([]);return}const a=`searchRecipes_${i}`,l=sessionStorage.getItem(a);if(l)try{const n=JSON.parse(l);p(n)}catch(n){console.error("Failed to parse cached recipes:",n),w(i)}else w(i);return()=>{m.current&&m.current.abort()}},[i]),s.useEffect(()=>{if(i&&d.length>0){const a=`searchRecipes_${i}`;sessionStorage.setItem(a,JSON.stringify(d))}},[d,i]);const x=s.useCallback(a=>{const{type:l,id:n,data:f,imageUrl:T,message:c,error:b}=a;switch(l){case"start":case"startAI":break;case"DbData":try{p(t=>{const e=t.findIndex(r=>r._id===n);if(e!==-1){const r=[...t];return r[e]={...r[e],...f},r}else return[...t,{_id:n,...f}]})}catch(t){console.error("Error parsing data chunk:",t)}break;case"data":try{const t=JSON.parse(f);p(e=>{const r=e.findIndex(u=>u._id===n);if(r!==-1){const u=[...e];return u[r]={...u[r],...t},u}else return[...e,{_id:n,...t}]})}catch(t){console.error("Error parsing data chunk:",t)}break;case"image":p(t=>t.map(e=>e._id===n?{...e,imageUrl:T}:e));break;case"complete":break;case"end":break;case"error":j(`Error fetching meal with ID ${n}: ${b}`);break}},[]),w=s.useCallback(async(a,l=[])=>{const f=`${`${window.location.protocol}//api.${window.location.host}:3002`}/api/recipes/customReceipt?search=${encodeURIComponent(a)}&loadedMeals=${encodeURIComponent(l.join(","))}`;m.current=new AbortController;const{signal:T}=m.current;try{const c=await fetch(f,{signal:T});if(!c.ok)throw new Error("Failed to fetch meal data");const b=c.body.getReader(),t=new TextDecoder;y(!0);let e="";for(;;){const{value:r,done:u}=await b.read();if(u){y(!1);break}e+=t.decode(r,{stream:!0});let g=e.indexOf(`
`);for(;g!==-1;){const v=e.slice(0,g).trim();if(e=e.slice(g+1),v)try{const k=JSON.parse(v);x(k)}catch(k){console.error("Failed to parse JSON chunk:",k,"Chunk:",v)}g=e.indexOf(`
`)}}if(e.trim())try{const r=JSON.parse(e.trim());x(r)}catch(r){console.error("Failed to parse JSON chunk from remaining buffer:",r,"Buffer:",e)}}catch(c){c.name!=="AbortError"&&(j(c.message),console.error("Error fetching streamed data:",c),y(!1))}},[x]),E=()=>{const a=d.map(l=>l.name);w(i,a)};return s.useEffect(()=>{},[d]),o.jsxs("div",{className:"p-4",children:[o.jsxs("h1",{className:"text-2xl font-semibold mb-4",children:['Search Results for "',i,'"']}),S&&o.jsx("div",{className:"alert alert-error shadow-lg mb-4",children:o.jsxs("div",{children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current flex-shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9z"})}),o.jsx("span",{children:S})]})}),d.length===0&&!h&&!S&&o.jsx("div",{className:"text-gray-600",children:"No recipes found for your search."}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:[d.map(a=>a.name&&o.jsx(N,{recipe:a},a._id)),o.jsx("button",{onClick:E,disabled:h,className:`card shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center p-4 border border-gray-300 rounded-lg bg-white hover:bg-gray-100 ${h?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:h?"Loading...":"Load More"})]}),h&&o.jsx("div",{className:"mt-4 text-blue-500",children:"Loading recipes..."})]})}function _(){return o.jsx(A,{})}const L=Object.freeze(Object.defineProperty({__proto__:null,Page:_},Symbol.toStringTag,{value:"Module"})),V={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/components/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:R}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:U}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.jsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:C}]},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.js",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:z}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.js",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:D}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/search/+Page.jsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:L}},hooksTimeout:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/search/+config.js",fileExportPathToShowToUser:["default","hooksTimeout"]},valueSerialized:{type:"js-serialized",value:{data:{warning:!1,error:!1,onRenderClient:!1}}}}};export{V as configValuesSerialized};
